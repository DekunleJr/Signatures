import{r as i,u as G,a as H,j as e}from"./index-DOUEz65m.js";import{c as d}from"./customAxios-D_Yu-ABU.js";/* empty css                  */import{L as P}from"./Loader-BUI7j79N.js";import"./index-ngrFHoWO.js";const b=10;function X(){const[x,p]=i.useState([]),[D,f]=i.useState(!0),[y,M]=i.useState(null),[o,L]=i.useState(1),[v,T]=i.useState(0),[N,S]=i.useState([]),{user:r,toast:l}=G(),m=H(),[E,C]=i.useState(""),[_,k]=i.useState(""),[c,A]=i.useState("all_except_admin"),[w,U]=i.useState([]),[z,B]=i.useState([]),[j,$]=i.useState(!1);i.useEffect(()=>{(async()=>{if(!r||!r.is_admin){l.error("You are not authorized to view this page."),m("/");return}f(!0);try{const s=(o-1)*b,a=b,{data:n}=await d.get(`/admin/?skip=${s}&limit=${a}`);p(n.users),T(n.total_users)}catch(s){console.error("Error fetching users:",s),M(s.message),l.error(`Failed to fetch users: ${s.message}`)}finally{f(!1)}})()},[r,m,l,o]),i.useEffect(()=>{const t=async()=>{if(!(!r||!r.is_admin))try{const{data:a}=await d.get("/admin/?skip=0&limit=99999");B(a.users)}catch(a){console.error("Error fetching all users for selection:",a)}},s=async()=>{if(!(!r||!r.is_admin))try{const{data:a}=await d.get("/portfolio/categories");S(a)}catch(a){console.error("Error fetching categories:",a),l.error(`Failed to fetch categories: ${a.message}`)}};t(),s()},[r,l]);const O=async(t,s)=>{if(!r||!r.is_admin){l.error("You are not authorized to block/unblock users.");return}const a=s==="active"?"block":"unblock";if(window.confirm(`Are you sure you want to ${a} this user?`))try{const{data:h}=await d.put(`/admin/block-unblock/${t}`);l.success(`User ${a}ed successfully!`),p(I=>I.map(F=>F.id===t?h:F))}catch(h){console.error(`Error ${a}ing user:`,h),l.error(`Failed to ${a} user. Please try again.`)}},R=async t=>{if(!r||!r.is_admin){l.error("You are not authorized to delete categories.");return}if(window.confirm("Are you sure you want to delete this category?"))try{await d.delete(`/portfolio/category/${t}`),l.success("Category deleted successfully!"),S(a=>a.filter(n=>n.id!==t))}catch(a){console.error("Error deleting category:",a),l.error("Failed to delete category. Please try again.")}},Y=t=>{const s=t.target.options,a=[];for(let n=0,h=s.length;n<h;n++)s[n].selected&&a.push(s[n].value);U(a)},q=async t=>{if(t.preventDefault(),!r||!r.is_admin){l.error("You are not authorized to broadcast emails.");return}$(!0);try{const s={subject:E,message:_,send_option:c,selected_emails:c==="all_except_selected"||c==="only_selected"?w:void 0},{data:a}=await d.post("/admin/broadcast-email",s);l.success(a.message),C(""),k(""),A("all_except_admin"),U([])}catch(s){console.error("Error broadcasting email:",s),l.error(`Failed to send email: ${s.response?.data?.detail||s.message}`)}finally{$(!1)}},u=Math.ceil(v/b),g=t=>{t>0&&t<=u&&L(t)};return D?e.jsx("div",{style:{position:"relative",margin:"auto 0"},children:e.jsx(P,{})}):y?e.jsxs("div",{className:"admin-page-container error-message",children:["Error: ",y]}):!r||!r.is_admin?null:e.jsxs("div",{className:"admin-page-container",children:[e.jsx("h1",{children:"Admin Dashboard"}),e.jsxs("div",{className:"broadcast-email-section",children:[e.jsx("h2",{children:"Broadcast Email to Users"}),e.jsxs("form",{onSubmit:q,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"subject",children:"Subject:"}),e.jsx("input",{type:"text",id:"subject",value:E,onChange:t=>C(t.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"message",children:"Message:"}),e.jsx("textarea",{id:"message",value:_,onChange:t=>k(t.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"sendOption",children:"Send To:"}),e.jsxs("select",{id:"sendOption",value:c,onChange:t=>A(t.target.value),children:[e.jsx("option",{value:"all_except_admin",children:"All users (except admin)"}),e.jsx("option",{value:"all_except_selected",children:"All users (except selected)"}),e.jsx("option",{value:"only_selected",children:"Only selected users"})]})]}),(c==="all_except_selected"||c==="only_selected")&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"selectedEmails",children:"Select Users:"}),e.jsx("select",{id:"selectedEmails",multiple:!0,value:w,onChange:Y,children:z.map(t=>e.jsxs("option",{value:t.email,children:[t.first_name," ",t.last_name," (",t.email,")"]},t.id))}),e.jsx("p",{className:"hint",children:"Hold Ctrl/Cmd to select multiple users."})]}),e.jsx("button",{type:"submit",className:"btn send-email-btn",disabled:j,children:j?"Sending...":"Send Email"})]}),j&&e.jsx("div",{style:{position:"relative",margin:"20px auto",width:"50px",height:"50px"},children:e.jsx(P,{})})]}),e.jsx("h2",{children:"User Management"}),x.length===0&&v===0?e.jsx("p",{children:"No users found."}):x.length===0?e.jsx("p",{children:"No users found on this page."}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"users-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"First Name"}),e.jsx("th",{children:"Last Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Phone Number"}),e.jsx("th",{children:"User Role"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Member Since"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:x.map(t=>e.jsxs("tr",{style:{textTransform:"capitalize"},children:[e.jsx("td",{"data-label":"ID",children:t.id}),e.jsx("td",{"data-label":"First Name",children:t.first_name}),e.jsx("td",{"data-label":"Last Name",children:t.last_name}),e.jsx("td",{"data-label":"Email",style:{textTransform:"lowercase"},children:t.email}),e.jsx("td",{"data-label":"Phone Number",children:t.phone_number||"N/A"}),e.jsx("td",{"data-label":"User Role",children:t.is_admin?"admin":"user"}),e.jsx("td",{"data-label":"Status",children:t.status}),e.jsx("td",{"data-label":"Member Since",children:new Date(t.created_at).toLocaleDateString()}),e.jsxs("td",{"data-label":"Action",children:[e.jsx("button",{className:"btn",onClick:()=>m(`/admin/edit-user/${t.id}`),children:"Edit"}),e.jsx("button",{className:`btn ${t.status==="active"?"delete-user-btn":"unblock-user-btn"}`,onClick:()=>O(t.id,t.status),children:t.status==="active"?"Block":"Unblock"})]})]},t.id))})]})}),e.jsxs("div",{className:"category-management-section",children:[e.jsx("h2",{children:"Category Management"}),N.length===0?e.jsx("p",{children:"No categories found."}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"users-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Title"}),e.jsx("th",{className:"category-action-header",children:"Action"})]})}),e.jsx("tbody",{children:N.map(t=>e.jsxs("tr",{children:[e.jsx("td",{"data-label":"ID",children:t.id}),e.jsx("td",{"data-label":"Title",children:t.title}),e.jsxs("td",{"data-label":"Action",className:"category-action-buttons",children:[e.jsx("button",{className:"btn",onClick:()=>m(`/category/edit/${t.id}`),children:"Edit"}),e.jsx("button",{className:"btn delete-user-btn",onClick:()=>R(t.id),children:"Delete"})]})]},t.id))})]})})]}),u>1&&e.jsxs("div",{className:"pagination-controls",children:[e.jsx("button",{className:"btn",onClick:()=>g(o-1),disabled:o===1,children:"Previous"}),[...Array(u)].map((t,s)=>e.jsx("button",{className:`btn ${o===s+1?"active":""}`,onClick:()=>g(s+1),children:s+1},s+1)),e.jsx("button",{className:"btn",onClick:()=>g(o+1),disabled:o===u,children:"Next"})]})]})}export{X as default};
