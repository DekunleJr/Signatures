import{r as l,a as U,b as G,u as R,j as e,G as V,L as S}from"./index-CARJ9Xvy.js";import{a as h}from"./index-ngrFHoWO.js";import{L}from"./Loader-Cv4_nWFN.js";class p extends Error{}p.prototype.name="InvalidTokenError";function A(t){return decodeURIComponent(atob(t).replace(/(.)/g,(a,o)=>{let i=o.charCodeAt(0).toString(16).toUpperCase();return i.length<2&&(i="0"+i),"%"+i}))}function F(t){let a=t.replace(/-/g,"+").replace(/_/g,"/");switch(a.length%4){case 0:break;case 2:a+="==";break;case 3:a+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return A(a)}catch{return atob(a)}}function q(t,a){if(typeof t!="string")throw new p("Invalid token specified: must be a string");a||(a={});const o=a.header===!0?0:1,i=t.split(".")[o];if(typeof i!="string")throw new p(`Invalid token specified: missing part #${o+1}`);let u;try{u=F(i)}catch(n){throw new p(`Invalid token specified: invalid base64 for part #${o+1} (${n.message})`)}try{return JSON.parse(u)}catch(n){throw new p(`Invalid token specified: invalid json for part #${o+1} (${n.message})`)}}function Y(){const[t,a]=l.useState(""),[o,i]=l.useState(""),[u,n]=l.useState(""),[E,g]=l.useState(!1),[P,N]=l.useState(""),[y,v]=l.useState(!1),[w,b]=l.useState(!1),k=U(),C=G(),{login:x,toast:j}=R(),_=C.state?.from?.pathname||"/",T=async s=>{s.preventDefault(),n(""),g(!1),b(!0);const c=new URLSearchParams;c.append("username",t),c.append("password",o);try{const r="http://localhost:8000",{data:d}=await h.post(`${r}/api/login`,c.toString(),{"Content-Type":"application/x-www-form-urlencoded"});x(d.access_token,{first_name:d.first_name,is_admin:d.is_admin,status:d.status}),k(_,{replace:!0})}catch(r){console.error("Error during login:",r),r.response?.data?.detail==="Account not verified. Please check your email for a verification link."?(n("Your account is pending verification. Please check your email for a verification link."),g(!0),N(t)):r.response?.data?.detail==="Account blocked. Please contact support."?n("Your account is blocked. Please contact support."):n("Invalid Credentials. Please check your email and password.")}finally{b(!1)}},I=async()=>{v(!0);try{await h.post("http://localhost:8000/api/resend-verification",{email:P},{headers:{"Content-Type":"application/json"}}),j.success("New verification link sent to your email!"),n(""),g(!1)}catch(s){console.error("Error resending verification link:",s),j.error(s.response?.data?.detail||"Failed to resend verification link. Please try again.")}finally{v(!1)}},$=async s=>{const c=s.credential,r=q(c),d={email:r.email,first_name:r.given_name||"",last_name:r.family_name||"",phone_number:r.phone_number||null,google_id_token:c};try{const m="http://localhost:8000",{data:f}=await h.post(`${m}/api/google-signup-login`,d,{headers:{"Content-Type":"application/json"}});x(f.access_token,{first_name:f.first_name,is_admin:f.is_admin}),k(_,{replace:!0})}catch(m){console.log(m),n("An error occurred during Google login. Please try again later.")}},D=()=>{n("Google login failed. Please try again.")};return e.jsx("div",{className:"login-container",children:e.jsxs("form",{className:"login-form",onSubmit:T,children:[e.jsx("h2",{children:"Login"}),u&&e.jsx("p",{className:"error-message",children:u}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{type:"email",id:"email",value:t,onChange:s=>a(s.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsx("input",{type:"password",id:"password",value:o,onChange:s=>i(s.target.value),required:!0})]}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:w,children:w?e.jsx(L,{loaderType:"Pulse",size:10}):"Login"}),E&&e.jsx("div",{className:"verification-message-container",children:e.jsx("button",{type:"button",className:"btn-secondary",onClick:I,disabled:y,children:y?e.jsx(L,{loaderType:"Pulse",size:10}):"Resend Verification Link"})}),e.jsx("div",{className:"google-login-button-container",children:e.jsx(V,{onSuccess:$,onError:D,useOneTap:!0})}),e.jsxs("p",{className:"signup-link-container",children:["Don't have an account? ",e.jsx(S,{to:"/signup",children:"Sign Up"})]}),e.jsx("p",{className:"signup-link-container",children:e.jsx(S,{to:"/forgot-password",children:"Forgot Password?"})})]})})}export{Y as default};
