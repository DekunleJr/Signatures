import{d as _,a as $,r,u as O,j as e}from"./index-DeBqqVjU.js";import{c as T,a as N}from"./customAxios-D_Yu-ABU.js";import{L as U}from"./Loader-nxn2YKjs.js";import"./index-ngrFHoWO.js";function X(){const{work_id:n}=_(),d=$(),[u,g]=r.useState(""),{toast:h}=O(),[p,x]=r.useState(""),[f,k]=r.useState(null),[S,C]=r.useState([]),[j,E]=r.useState(""),[b,W]=r.useState([]),[l,D]=r.useState([]),[c,o]=r.useState(!1),[v,m]=r.useState(null),[y,I]=r.useState(null),i=!!n;r.useEffect(()=>{i&&(async()=>{o(!0);try{const a=(await T.get(`/portfolio/${n}`)).data;g(a.title),x(a.description),E(a.img_url),W(a.other_image_urls||[])}catch(t){m(t.message)}finally{o(!1)}})()},[n,i]);const w=s=>{k(s.target.files[0])},A=s=>{C(Array.from(s.target.files))},F=s=>{D(t=>[...t,s])},M=async s=>{s.preventDefault(),o(!0),m(null),I(null);const t=new FormData;t.append("title",u),t.append("description",p),f&&t.append("img_url",f),S.forEach(a=>{t.append("other_images",a)}),l.forEach(a=>{t.append("images_to_delete",a)});try{await(i?N.put(`/portfolio/${n}`,t):N.post("/portfolio/",t)),I(`Work ${i?"updated":"added"} successfully!`),h.success(`Work ${i?"updated":"added"} successfully!`),setTimeout(()=>{d("/portfolio")},1500)}catch(a){console.error("Submission error:",a),h.error(a.message),m("An unexpected error occurred. Please try again.")}finally{o(!1)}};return e.jsxs("div",{className:"service-form-container",style:{position:"relative"},children:[e.jsx("h1",{children:i?"Edit Work":"Add New Work"}),c&&e.jsx(U,{}),v&&e.jsx("p",{className:"error-message",children:v}),y&&e.jsx("p",{className:"success-message",children:y}),e.jsxs("form",{onSubmit:M,className:"work-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"title",children:"Title"}),e.jsx("input",{type:"text",id:"title",value:u,onChange:s=>g(s.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",value:p,onChange:s=>x(s.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"mainImage",children:"Main Image"}),e.jsx("input",{type:"file",id:"mainImage",onChange:w,required:!i,style:{padding:".5rem"}}),i&&j&&e.jsxs("div",{children:[e.jsx("p",{children:"Current main image:"}),e.jsx("img",{src:j,alt:"Current Work Main Image",className:"current-main-image-thumbnail"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"otherImages",children:"Other Images (optional)"}),e.jsx("input",{type:"file",id:"otherImages",multiple:!0,onChange:A,style:{padding:".5rem"}}),i&&b.length>0&&e.jsxs("div",{children:[e.jsx("p",{children:"Current other images:"}),e.jsx("div",{className:"existing-thumbnails",children:b.map((s,t)=>e.jsxs("div",{className:`existing-thumbnail-wrapper ${l.includes(s)?"marked-for-deletion":""}`,children:[e.jsx("img",{src:s,alt:`Existing other image ${t+1}`,className:"existing-thumbnail"}),!l.includes(s)&&e.jsx("button",{type:"button",className:"delete-image-btn",onClick:()=>F(s),children:"X"})]},t))})]})]}),e.jsxs("div",{className:"form-buttons",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>d(-1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-service",disabled:c,children:c?"Submitting...":i?"Update Work":"Add Work"})]})]})]})}export{X as default};
