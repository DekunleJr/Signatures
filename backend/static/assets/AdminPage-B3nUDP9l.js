import{r as a,u as R,a as Y,j as e}from"./index-AoGoU4kM.js";import{c as h}from"./customAxios-D_Yu-ABU.js";/* empty css                  */import{L as w}from"./Loader-DfnFbPMN.js";import"./index-ngrFHoWO.js";const g=10;function Q(){const[u,f]=a.useState([]),[F,b]=a.useState(!0),[v,P]=a.useState(null),[o,L]=a.useState(1),[S,M]=a.useState(0),{user:r,toast:n}=R(),x=Y(),[y,E]=a.useState(""),[N,_]=a.useState(""),[c,k]=a.useState("all_except_admin"),[C,U]=a.useState([]),[B,D]=a.useState([]),[j,A]=a.useState(!1);a.useEffect(()=>{(async()=>{if(!r||!r.is_admin){n.error("You are not authorized to view this page."),x("/");return}b(!0);try{const t=(o-1)*g,l=g,{data:i}=await h.get(`/admin/?skip=${t}&limit=${l}`);f(i.users),M(i.total_users)}catch(t){console.error("Error fetching users:",t),P(t.message),n.error(`Failed to fetch users: ${t.message}`)}finally{b(!1)}})()},[r,x,n,o]),a.useEffect(()=>{(async()=>{if(!(!r||!r.is_admin))try{const{data:t}=await h.get("/admin/?skip=0&limit=99999");D(t.users)}catch(t){console.error("Error fetching all users for selection:",t)}})()},[r]);const O=async(s,t)=>{if(!r||!r.is_admin){n.error("You are not authorized to block/unblock users.");return}const l=t==="active"?"block":"unblock";if(window.confirm(`Are you sure you want to ${l} this user?`))try{const{data:d}=await h.put(`/admin/block-unblock/${s}`);n.success(`User ${l}ed successfully!`),f(q=>q.map($=>$.id===s?d:$))}catch(d){console.error(`Error ${l}ing user:`,d),n.error(`Failed to ${l} user. Please try again.`)}},T=s=>{const t=s.target.options,l=[];for(let i=0,d=t.length;i<d;i++)t[i].selected&&l.push(t[i].value);U(l)},z=async s=>{if(s.preventDefault(),!r||!r.is_admin){n.error("You are not authorized to broadcast emails.");return}A(!0);try{const t={subject:y,message:N,send_option:c,selected_emails:c==="all_except_selected"||c==="only_selected"?C:void 0},{data:l}=await h.post("/admin/broadcast-email",t);n.success(l.message),E(""),_(""),k("all_except_admin"),U([])}catch(t){console.error("Error broadcasting email:",t),n.error(`Failed to send email: ${t.response?.data?.detail||t.message}`)}finally{A(!1)}},m=Math.ceil(S/g),p=s=>{s>0&&s<=m&&L(s)};return F?e.jsx("div",{style:{position:"relative",margin:"auto 0"},children:e.jsx(w,{})}):v?e.jsxs("div",{className:"admin-page-container error-message",children:["Error: ",v]}):!r||!r.is_admin?null:e.jsxs("div",{className:"admin-page-container",children:[e.jsx("h1",{children:"Admin Dashboard - User Management"}),e.jsxs("div",{className:"broadcast-email-section",children:[e.jsx("h2",{children:"Broadcast Email to Users"}),e.jsxs("form",{onSubmit:z,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"subject",children:"Subject:"}),e.jsx("input",{type:"text",id:"subject",value:y,onChange:s=>E(s.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"message",children:"Message:"}),e.jsx("textarea",{id:"message",value:N,onChange:s=>_(s.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"sendOption",children:"Send To:"}),e.jsxs("select",{id:"sendOption",value:c,onChange:s=>k(s.target.value),children:[e.jsx("option",{value:"all_except_admin",children:"All users (except admin)"}),e.jsx("option",{value:"all_except_selected",children:"All users (except selected)"}),e.jsx("option",{value:"only_selected",children:"Only selected users"})]})]}),(c==="all_except_selected"||c==="only_selected")&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"selectedEmails",children:"Select Users:"}),e.jsx("select",{id:"selectedEmails",multiple:!0,value:C,onChange:T,children:B.map(s=>e.jsxs("option",{value:s.email,children:[s.first_name," ",s.last_name," (",s.email,")"]},s.id))}),e.jsx("p",{className:"hint",children:"Hold Ctrl/Cmd to select multiple users."})]}),e.jsx("button",{type:"submit",className:"btn send-email-btn",disabled:j,children:j?"Sending...":"Send Email"})]}),j&&e.jsx("div",{style:{position:"relative",margin:"20px auto",width:"50px",height:"50px"},children:e.jsx(w,{})})]}),u.length===0&&S===0?e.jsx("p",{children:"No users found."}):u.length===0?e.jsx("p",{children:"No users found on this page."}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"users-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"First Name"}),e.jsx("th",{children:"Last Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Phone Number"}),e.jsx("th",{children:"User Role"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Member Since"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:u.map(s=>e.jsxs("tr",{style:{textTransform:"capitalize"},children:[e.jsx("td",{children:s.id}),e.jsx("td",{children:s.first_name}),e.jsx("td",{children:s.last_name}),e.jsx("td",{style:{textTransform:"lowercase"},children:s.email}),e.jsx("td",{children:s.phone_number||"N/A"}),e.jsx("td",{children:s.is_admin?"admin":"user"}),e.jsx("td",{children:s.status}),e.jsx("td",{children:new Date(s.created_at).toLocaleDateString()}),e.jsxs("td",{children:[e.jsx("button",{className:"btn",onClick:()=>x(`/admin/edit-user/${s.id}`),children:"Edit"}),e.jsx("button",{className:`btn ${s.status==="active"?"delete-user-btn":"unblock-user-btn"}`,onClick:()=>O(s.id,s.status),children:s.status==="active"?"Block":"Unblock"})]})]},s.id))})]})}),m>1&&e.jsxs("div",{className:"pagination-controls",children:[e.jsx("button",{className:"btn",onClick:()=>p(o-1),disabled:o===1,children:"Previous"}),[...Array(m)].map((s,t)=>e.jsx("button",{className:`btn ${o===t+1?"active":""}`,onClick:()=>p(t+1),children:t+1},t+1)),e.jsx("button",{className:"btn",onClick:()=>p(o+1),disabled:o===m,children:"Next"})]})]})}export{Q as default};
