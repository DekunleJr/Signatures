import{r as c,a as U,b as G,u as R,j as e,G as V,L as S}from"./index-CCXG2qkA.js";import{a as h}from"./index-ngrFHoWO.js";import{L}from"./Loader-BJ6CDxDy.js";class p extends Error{}p.prototype.name="InvalidTokenError";function A(n){return decodeURIComponent(atob(n).replace(/(.)/g,(a,o)=>{let i=o.charCodeAt(0).toString(16).toUpperCase();return i.length<2&&(i="0"+i),"%"+i}))}function F(n){let a=n.replace(/-/g,"+").replace(/_/g,"/");switch(a.length%4){case 0:break;case 2:a+="==";break;case 3:a+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return A(a)}catch{return atob(a)}}function Y(n,a){if(typeof n!="string")throw new p("Invalid token specified: must be a string");a||(a={});const o=a.header===!0?0:1,i=n.split(".")[o];if(typeof i!="string")throw new p(`Invalid token specified: missing part #${o+1}`);let u;try{u=F(i)}catch(s){throw new p(`Invalid token specified: invalid base64 for part #${o+1} (${s.message})`)}try{return JSON.parse(u)}catch(s){throw new p(`Invalid token specified: invalid json for part #${o+1} (${s.message})`)}}function O(){const[n,a]=c.useState(""),[o,i]=c.useState(""),[u,s]=c.useState(""),[P,g]=c.useState(!1),[E,N]=c.useState(""),[y,v]=c.useState(!1),[w,x]=c.useState(!1),b=U(),C=G(),{login:j,toast:k}=R(),_=C.state?.from?.pathname||"/",T=async t=>{t.preventDefault(),s(""),g(!1),x(!0);const l=new URLSearchParams;l.append("username",n),l.append("password",o);try{const r="https://2125signature.com",{data:d}=await h.post(`${r}/api/login`,l.toString(),{"Content-Type":"application/x-www-form-urlencoded"});j(d.access_token,{first_name:d.first_name,is_admin:d.is_admin,status:d.status}),b(_,{replace:!0})}catch(r){console.error("Error during login:",r),r.response?.data?.detail==="Account not verified. Please check your email for a verification link."?(s("Your account is pending verification. Please verify your email."),g(!0),N(n)):r.response?.data?.detail==="Account blocked. Please contact support."?s("Your account is blocked. Please contact support."):s("Invalid Credentials. Please check your email and password.")}finally{x(!1)}},I=async()=>{v(!0);try{await h.post("https://2125signature.com/api/resend-verification",{email:E},{headers:{"Content-Type":"application/json"}}),k.success("New verification link sent to your email!"),s(""),g(!1)}catch(t){console.error("Error resending verification link:",t),k.error(t.response?.data?.detail||"Failed to resend verification link. Please try again.")}finally{v(!1)}},$=async t=>{const l=t.credential,r=Y(l),d={email:r.email,first_name:r.given_name||"",last_name:r.family_name||"",phone_number:r.phone_number||null,google_id_token:l};try{const m="https://2125signature.com",{data:f}=await h.post(`${m}/api/google-signup-login`,d,{headers:{"Content-Type":"application/json"}});j(f.access_token,{first_name:f.first_name,is_admin:f.is_admin}),b(_,{replace:!0})}catch(m){console.log(m),s("An error occurred during Google login. Please try again later.")}},D=()=>{s("Google login failed. Please try again.")};return e.jsx("div",{className:"login-container",children:e.jsxs("form",{className:"login-form",onSubmit:T,children:[e.jsx("h2",{children:"Login"}),u&&e.jsx("p",{className:"error-message",children:u}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{type:"email",id:"email",value:n,onChange:t=>a(t.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsx("input",{type:"password",id:"password",value:o,onChange:t=>i(t.target.value),required:!0})]}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:w,children:w?e.jsx(L,{loaderType:"Pulse",size:10}):"Login"}),P&&e.jsxs("div",{className:"verification-message-container",children:[e.jsx("p",{className:"info-message",children:"Your account is pending verification. Please check your email for a verification link."}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:I,disabled:y,children:y?e.jsx(L,{loaderType:"Pulse",size:10}):"Resend Verification Link"})]}),e.jsx("div",{className:"google-login-button-container",children:e.jsx(V,{onSuccess:$,onError:D,useOneTap:!0})}),e.jsxs("p",{className:"signup-link-container",children:["Don't have an account? ",e.jsx(S,{to:"/signup",children:"Sign Up"})]}),e.jsx("p",{className:"signup-link-container",children:e.jsx(S,{to:"/forgot-password",children:"Forgot Password?"})})]})})}export{O as default};
