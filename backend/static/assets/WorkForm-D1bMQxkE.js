import{d as L,a as P,r as a,u as R,j as e}from"./index-duV4Qe54.js";import{c as k,a as E}from"./customAxios-D_Yu-ABU.js";import{L as X}from"./Loader-CaWW9ePG.js";/* empty css                    */import"./index-ngrFHoWO.js";function K(){const{work_id:n}=L(),u=P(),[g,h]=a.useState(""),{toast:p}=R(),[x,f]=a.useState(""),[j,y]=a.useState(""),[W,_]=a.useState([]),[v,w]=a.useState(null),[D,F]=a.useState([]),[b,A]=a.useState(""),[I,M]=a.useState([]),[c,$]=a.useState([]),[d,l]=a.useState(!1),[N,m]=a.useState(null),[C,S]=a.useState(null),r=!!n;a.useEffect(()=>{(async()=>{try{const{data:s}=await k.get("/portfolio/categories");_(s)}catch(s){console.error("Error fetching categories:",s)}})(),r&&(async()=>{l(!0);try{const o=(await k.get(`/portfolio/${n}`)).data;h(o.title),f(o.description),y(o.category_id),A(o.img_url),M(o.other_image_urls||[])}catch(i){m(i.message)}finally{l(!1)}})()},[n,r]);const O=t=>{w(t.target.files[0])},T=t=>{F(Array.from(t.target.files))},U=t=>{$(s=>[...s,t])},q=async t=>{t.preventDefault(),l(!0),m(null),S(null);const s=new FormData;s.append("title",g),s.append("description",x),s.append("category_id",j),v&&s.append("img_url",v),D.forEach(i=>{s.append("other_images",i)}),c.forEach(i=>{s.append("images_to_delete",i)});try{await(r?E.put(`/portfolio/${n}`,s):E.post("/portfolio/",s)),S(`Work ${r?"updated":"added"} successfully!`),p.success(`Work ${r?"updated":"added"} successfully!`),setTimeout(()=>{u("/portfolio")},1500)}catch(i){console.error("Submission error:",i),p.error(i.message),m("An unexpected error occurred. Please try again.")}finally{l(!1)}};return e.jsxs("div",{className:"service-form-container",style:{position:"relative"},children:[e.jsx("h1",{children:r?"Edit Work":"Add New Work"}),d&&e.jsx(X,{}),N&&e.jsx("p",{className:"error-message",children:N}),C&&e.jsx("p",{className:"success-message",children:C}),e.jsxs("form",{onSubmit:q,className:"work-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"title",children:"Title"}),e.jsx("input",{type:"text",id:"title",value:g,onChange:t=>h(t.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",value:x,onChange:t=>f(t.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"category",children:"Category"}),e.jsxs("select",{id:"category",value:j,onChange:t=>y(t.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select a category"}),W.map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"mainImage",children:"Main Image"}),e.jsx("input",{type:"file",id:"mainImage",onChange:O,required:!r,style:{padding:".5rem"}}),r&&b&&e.jsxs("div",{children:[e.jsx("p",{children:"Current main image:"}),e.jsx("img",{src:b,alt:"Current Work Main Image",className:"current-main-image-thumbnail"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"otherImages",children:"Other Images (optional)"}),e.jsx("input",{type:"file",id:"otherImages",multiple:!0,onChange:T,style:{padding:".5rem"}}),r&&I.length>0&&e.jsxs("div",{children:[e.jsx("p",{children:"Current other images:"}),e.jsx("div",{className:"existing-thumbnails",children:I.map((t,s)=>e.jsxs("div",{className:`existing-thumbnail-wrapper ${c.includes(t)?"marked-for-deletion":""}`,children:[e.jsx("img",{src:t,alt:`Existing other image ${s+1}`,className:"existing-thumbnail"}),!c.includes(t)&&e.jsx("button",{type:"button",className:"delete-image-btn",onClick:()=>U(t),children:"X"})]},s))})]})]}),e.jsxs("div",{className:"form-buttons",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>u(-1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-service",disabled:d,children:d?"Submitting...":r?"Update Work":"Add Work"})]})]})]})}export{K as default};
