import{r as n,u as H,a as I,j as e}from"./index-B1sdUBI6.js";import{c as d}from"./customAxios-D_Yu-ABU.js";/* empty css                  */import{L as P}from"./Loader-CxZFoJUg.js";import"./index-ngrFHoWO.js";const p=10;function X(){const[x,f]=n.useState([]),[D,b]=n.useState(!0),[y,M]=n.useState(null),[o,L]=n.useState(1),[v,T]=n.useState(0),[N,E]=n.useState([]),{user:r,toast:i}=H(),m=I(),[S,C]=n.useState(""),[_,k]=n.useState(""),[c,w]=n.useState("all_except_admin"),[A,U]=n.useState([]),[z,B]=n.useState([]),[j,$]=n.useState(!1);n.useEffect(()=>{(async()=>{if(!r||!r.is_admin){i.error("You are not authorized to view this page."),m("/");return}b(!0);try{const t=(o-1)*p,a=p,{data:l}=await d.get(`/admin/?skip=${t}&limit=${a}`);f(l.users),T(l.total_users)}catch(t){console.error("Error fetching users:",t),M(t.message),i.error(`Failed to fetch users: ${t.message}`)}finally{b(!1)}})()},[r,m,i,o]),n.useEffect(()=>{const s=async()=>{if(!(!r||!r.is_admin))try{const{data:a}=await d.get("/admin/?skip=0&limit=99999");B(a.users)}catch(a){console.error("Error fetching all users for selection:",a)}},t=async()=>{if(!(!r||!r.is_admin))try{const{data:a}=await d.get("/portfolio/categories");E(a)}catch(a){console.error("Error fetching categories:",a),i.error(`Failed to fetch categories: ${a.message}`)}};s(),t()},[r,i]);const O=async(s,t)=>{if(!r||!r.is_admin){i.error("You are not authorized to block/unblock users.");return}const a=t==="active"?"block":"unblock";if(window.confirm(`Are you sure you want to ${a} this user?`))try{const{data:h}=await d.put(`/admin/block-unblock/${s}`);i.success(`User ${a}ed successfully!`),f(G=>G.map(F=>F.id===s?h:F))}catch(h){console.error(`Error ${a}ing user:`,h),i.error(`Failed to ${a} user. Please try again.`)}},Y=async s=>{if(!r||!r.is_admin){i.error("You are not authorized to delete categories.");return}if(window.confirm("Are you sure you want to delete this category?"))try{await d.delete(`/portfolio/category/${s}`),i.success("Category deleted successfully!"),E(a=>a.filter(l=>l.id!==s))}catch(a){console.error("Error deleting category:",a),i.error("Failed to delete category. Please try again.")}},q=s=>{const t=s.target.options,a=[];for(let l=0,h=t.length;l<h;l++)t[l].selected&&a.push(t[l].value);U(a)},R=async s=>{if(s.preventDefault(),!r||!r.is_admin){i.error("You are not authorized to broadcast emails.");return}$(!0);try{const t={subject:S,message:_,send_option:c,selected_emails:c==="all_except_selected"||c==="only_selected"?A:void 0},{data:a}=await d.post("/admin/broadcast-email",t);i.success(a.message),C(""),k(""),w("all_except_admin"),U([])}catch(t){console.error("Error broadcasting email:",t),i.error(`Failed to send email: ${t.response?.data?.detail||t.message}`)}finally{$(!1)}},u=Math.ceil(v/p),g=s=>{s>0&&s<=u&&L(s)};return D?e.jsx("div",{style:{position:"relative",margin:"auto 0"},children:e.jsx(P,{})}):y?e.jsxs("div",{className:"admin-page-container error-message",children:["Error: ",y]}):!r||!r.is_admin?null:e.jsxs("div",{className:"admin-page-container",children:[e.jsx("h1",{children:"Admin Dashboard"}),e.jsxs("div",{className:"broadcast-email-section",children:[e.jsx("h2",{children:"Broadcast Email to Users"}),e.jsxs("form",{onSubmit:R,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"subject",children:"Subject:"}),e.jsx("input",{type:"text",id:"subject",value:S,onChange:s=>C(s.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"message",children:"Message:"}),e.jsx("textarea",{id:"message",value:_,onChange:s=>k(s.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"sendOption",children:"Send To:"}),e.jsxs("select",{id:"sendOption",value:c,onChange:s=>w(s.target.value),children:[e.jsx("option",{value:"all_except_admin",children:"All users (except admin)"}),e.jsx("option",{value:"all_except_selected",children:"All users (except selected)"}),e.jsx("option",{value:"only_selected",children:"Only selected users"})]})]}),(c==="all_except_selected"||c==="only_selected")&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"selectedEmails",children:"Select Users:"}),e.jsx("select",{id:"selectedEmails",multiple:!0,value:A,onChange:q,children:z.map(s=>e.jsxs("option",{value:s.email,children:[s.first_name," ",s.last_name," (",s.email,")"]},s.id))}),e.jsx("p",{className:"hint",children:"Hold Ctrl/Cmd to select multiple users."})]}),e.jsx("button",{type:"submit",className:"btn send-email-btn",disabled:j,children:j?"Sending...":"Send Email"})]}),j&&e.jsx("div",{style:{position:"relative",margin:"20px auto",width:"50px",height:"50px"},children:e.jsx(P,{})})]}),e.jsx("h2",{children:"User Management"}),x.length===0&&v===0?e.jsx("p",{children:"No users found."}):x.length===0?e.jsx("p",{children:"No users found on this page."}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"users-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"First Name"}),e.jsx("th",{children:"Last Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Phone Number"}),e.jsx("th",{children:"User Role"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Member Since"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:x.map(s=>e.jsxs("tr",{style:{textTransform:"capitalize"},children:[e.jsx("td",{children:s.id}),e.jsx("td",{children:s.first_name}),e.jsx("td",{children:s.last_name}),e.jsx("td",{style:{textTransform:"lowercase"},children:s.email}),e.jsx("td",{children:s.phone_number||"N/A"}),e.jsx("td",{children:s.is_admin?"admin":"user"}),e.jsx("td",{children:s.status}),e.jsx("td",{children:new Date(s.created_at).toLocaleDateString()}),e.jsxs("td",{children:[e.jsx("button",{className:"btn",onClick:()=>m(`/admin/edit-user/${s.id}`),children:"Edit"}),e.jsx("button",{className:`btn ${s.status==="active"?"delete-user-btn":"unblock-user-btn"}`,onClick:()=>O(s.id,s.status),children:s.status==="active"?"Block":"Unblock"})]})]},s.id))})]})}),e.jsxs("div",{className:"category-management-section",children:[e.jsx("h2",{children:"Category Management"}),N.length===0?e.jsx("p",{children:"No categories found."}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"users-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Title"}),e.jsx("th",{className:"category-action-header",children:"Action"})]})}),e.jsx("tbody",{children:N.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.id}),e.jsx("td",{children:s.title}),e.jsxs("td",{className:"category-action-buttons",children:[e.jsx("button",{className:"btn",onClick:()=>m(`/category/edit/${s.id}`),children:"Edit"}),e.jsx("button",{className:"btn delete-user-btn",onClick:()=>Y(s.id),children:"Delete"})]})]},s.id))})]})})]}),u>1&&e.jsxs("div",{className:"pagination-controls",children:[e.jsx("button",{className:"btn",onClick:()=>g(o-1),disabled:o===1,children:"Previous"}),[...Array(u)].map((s,t)=>e.jsx("button",{className:`btn ${o===t+1?"active":""}`,onClick:()=>g(t+1),children:t+1},t+1)),e.jsx("button",{className:"btn",onClick:()=>g(o+1),disabled:o===u,children:"Next"})]})]})}export{X as default};
